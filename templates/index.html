{% raw %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Stylist assistant. Hello, bootstrap</title>
    <link href="static/bower_components/bootstrap/dist/css/bootstrap.css" rel="stylesheet">
    <link href="static/bower_components/jquery-ui/themes/base/jquery-ui.css" rel="stylesheet"/>
    <link href="static/templates.css" rel="stylesheet">
    <link rel="import" href="static/templates.html">
    <script src="static/bower_components/webcomponentsjs/HTMLImports.min.js"></script>
    <script src="static/templates.js"></script>

</head>
<body>
<style>

    .tools-item {
        width: 120px;
        height: 120px;
        display: inline-block;
        /*background-color: white;*/
        /*border: 1px black solid;*/
    }

    .tools-item img {
        max-width: 120px;
        max-height: 120px;
    }

    .look-item {
        position: absolute;
        width: 200px;
        height: 200px;
    }

    /*li {*/
    /*height: 38px;*/
    /*}*/
    #right-side li a {
        font-size: 10px;
    }

    a {
        color: #000;
        font-size: 15px;
        font-weight: 200;
        letter-spacing: 1.2px;
    }

    #active {
        border-bottom: 1px solid white;
    }

    #canvas {
        /*position: relative;*/
        /*margin: auto;*/
        /*border: 1px solid black;*/
        /*width: 400px;*/
        /*height: 400px;*/
    }

    #canvas div {
        overflow: hidden;
    }

    #canvas .opacity {
        opacity: 1;
        background-color: transparent;

    }

    #canvas img {
        display: block;
        max-width: 100%;
        max-height: 100%;
        margin: auto
    }

    .cell {
        position: absolute;
        width: 200px;
        height: 200px;
        border: black solid 1px;
    }
</style>

<!--TODO done add by drag&drop-->
<!--TODO done add different cells on canvas to add issues-->
<!--TODO done helper:clone to not disturb original item-->
<!--TODO add upper on bottom tabs -->
<!--TODO узкие шмотки типа туфлей и поясов можно подымыть повыше в минуса-->

<div class="container-fluid">
    <div class="row">
        <div id="canvas-container" class="col-sm-7" style="height: 100vh; background-color: white">
            <div id="switcher" style="display: inline-block">
                <select size="1" name="template">
                    <option disabled>Выберите шаблон</option>
                    <option value="elegant">elegant</option>
                    <option value="ink">ink</option>
                    <option selected value="hearts">hearts</option>
                    <option value="c11">c11</option>
                </select>
            </div>
            <span id="slider-span">
                choose scale:<div id="slider" style="width: 300px; display: inline-block"></div>
                <!--<button onclick="stopSlider()">finish scaling</button>-->
            </span>
            <div id="canvas" style="position: relative">
            </div>

        </div>
        <div id="right-side" class="col-sm-5" style="height: 100vh;background-color: #eee">
            <ul style="font-size: 7px">
                <!--<li><a href="#tabs-home">Home</a></li>-->
                <!--<br><br><br>-->
                <!--<li><a href="#tab-all">Всё</a></li>-->
                <li><a href="#tab-dresses">Платья</a></li>
                <li><a href="#tab-shoes">Обувь</a></li>
                <li><a href="#tab-blues">Топы&Блузки</a></li>
                <li><a href="#tab-skirts">Юбки</a></li>
                <li><a href="#tab-acc">Аксессуары</a></li>
            </ul>
            <!--<div id="tabs-home">-->
            <!--</div>-->
            <!--<div id="tab-all">all-->
            <!--</div>-->
            <div id="tab-dresses">dresses
            </div>
            <div id="tab-shoes">shoes
            </div>
            <div id="tab-skirts">skirts
            </div>
            <div id="tab-acc">acc
            </div>
            <div id="tab-blues">blues
            </div>

            <!--<div id="tools" style="border-color: black">-->
            <!--</div>-->
            <!--menu was here and moved to bottom-->
            <!--<form>-->
            <!--<input id="screen" type="button" value="screen">-->
            <!--</form>-->
            <!--<label>maximal price<input id="maxprice" type="text" value="10000"></label>-->
            <!--<input type="button" id="filter-submit"-->
            <!--value="filter it" onclick="maxpriceChanged()">-->

            <!--<img id="top01" src="static/dresses/top01.jpg">-->
            <!--end issues div-->
        </div><!--end right-side -->
    </div>
</div>

<script src="static/bower_components/jquery/dist/jquery.min.js"></script>
<!--<script src="static/bower_components/bootstrap/dist/js/bootstrap.min.js"></script>-->
<script src="static/bower_components/jquery-ui/jquery-ui.min.js"></script>
<script src="static/html2canvas.js"></script>
<script>
     window.addEventListener('HTMLImportsLoaded', function (e) {
        console.log('Loaded import: ');
        loadTemplate($("#switcher :selected").val());
    });
    var links = []; //['static/pics/out01.png', 'static/pics/AT006EMFQJ85_1_v2.png', 'static/pics/OO001EWIWW29_1_v2.png'];
    $('#switcher').change(function () {
        console.log('selected ' + $("#switcher :selected").val());
        $('#canvas').empty();
        loadTemplate($("#switcher :selected").val());
    });
    $('#slider-span').hide();
    $('#canvas').attr('disabled', 'disabled');

    $("#right-side").tabs();
    $("#right-side").tabs("option", "active", 0);
    $("#tab-dresses").click = function () {
        alert('tab-dresses clicked')
    };
    var tools_filter = {};
    const tools_max = 5;
    tools = {};

    function toolsItem(id, src, alt) {
        rez = '<div class="tools-item"><img id="' + id + '" src="' +
                src + '" title="' + alt + '"></div>';
        return rez;
    }

    function updateToolsFilter(tab) {
        console.log('in tab update');
        $('#' + tab).empty();
        var i = 0;
        for (i; i < tools.length; i++) {
            $('#' + tab).append(
                    toolsItem(tools[i]._id, "static/pics/" + tools[i].pictures[0], tools[i].description));
            //$('#' + tools[i]._id).one("click", addIssue);//adding by click
//            $('#' + tools[i]._id).draggable(

        }
        $('.tools-item img').draggable(
                {helper: 'clone'});
    }

    function getDataForTab(tab) {
        tab = tab || 'tab-all';
        var requests = {
            'tab-all': "https%3A//api.mlab.com/api/1/databases/shopeiro/collections/tools%3Fl%3D12%26apiKey%3Dgyxt40ZuBvX0-Zs_ASfIphz87os52wgf",
            'tab-dresses': "https%3A//api.mlab.com/api/1/databases/shopeiro/collections/tools%3Fl%3D12%26q%3D%7B%22typePrefix%22%3A%22%u041F%u043B%u0430%u0442%u044C%u0435%22%7D%26apiKey%3Dgyxt40ZuBvX0-Zs_ASfIphz87os52wgf",
            'tab-shoes': "https%3A//api.mlab.com/api/1/databases/shopeiro/collections/tools%3Fl%3D12%26q%3D%7B%22typePrefix%22%3A%22%u0422%u0443%u0444%u043B%u0438%22%7D%26apiKey%3Dgyxt40ZuBvX0-Zs_ASfIphz87os52wgf"
//            ,
//            'tab-blues': `https://api.mlab.com/api/1/databases/shopeiro/collections/tools?l=12&q={"typePrefix":"Блуза"}&apiKey=gyxt40ZuBvX0-Zs_ASfIphz87os52wgf`,
//            'tab-skirts': `https://api.mlab.com/api/1/databases/shopeiro/collections/tools?l=12&q={"typePrefix":"Юбка"}&apiKey=gyxt40ZuBvX0-Zs_ASfIphz87os52wgf`,
//            'tab-acc': `https://api.mlab.com/api/1/databases/shopeiro/collections/tools?l=12&q={"typePrefix":"Косметичка"}&apiKey=gyxt40ZuBvX0-Zs_ASfIphz87os52wgf`
        };
        $.ajax({
            url: unescape(requests[tab]),
            success: function (data) {
                console.log(data);
                tools = data;
                if (tab) {
                    var i;
                    for (i = 0; i < tools.length; i++) {
                        tools[i].pictures[0] = tools[i].pictures[0].substring(0, tools[i].pictures[0].length - 3) + 'png';
                        //console.log(tools[i].pictures[0])
                    }
                    updateToolsFilter(tab);
                }

            }
        });
    }

    getDataForTab('tab-dresses');
    //    getDataForTab('tab-shoes');
    //    getDataForTab('tab-blues');
    //    getDataForTab('tab-skirts');
    //    getDataForTab('tab-acc');

    function canvasItem(id, src, alt) {
        rez = '<img id="' + id + '"class="tools-item" src="' +
                src + '" title="' + alt + '">';
        return rez;
    }

    function stopSlider() {
        console.log('try to stop slider');
        $('#slider').slider('destroy');
        $('#slider-span').hide();
    }

    function scaleCellContent() {
        console.log('' + this + ' clicked');
        $('#slider-span').show();
        var img = this;
        $('#slider').slider({
            slide: function (event, ui) {
                console.log('you changed slider to ' + ui.value);
                var currentScale = 100 + 2 * ui.value;
                $(img).attr('style', 'max-height: ' + currentScale + "%;" + 'max-width: ' + currentScale + "%;");

            },
            change: stopSlider
        });
    }

    function droppedIn(event, ui) {
        console.log('in droppedIn ' + ui.draggable.attr('id') +
                ui.draggable.attr('src') + ui.draggable.attr('title'));
        $(this).empty();
        $(this).addClass('opacity');
        $('<img src=' + ui.draggable.attr('src') + '>').click(scaleCellContent).appendTo(this);
//        $(this).append(
//                '<img src=' + ui.draggable.attr('src') + '>'
//        );

//        $(this).attr('src',ui.draggable.attr('src'));
        //$(this).append("<p>ppp<p>");
//        $(this).append(
//                '<img id="' + ui.draggable.attr('id') + '"class="look-item" src="' +
//                ui.draggable.attr('src') + '" title="' + ui.draggable.attr('title') + '">'
//        );
    }

    //    $('#0').droppable({drop: droppedIn});
    //    $('#1').droppable({drop: droppedIn});
    //    $('#2').droppable({drop: droppedIn});


    function addIssue(e) {
        console.log('in addIssue handler');
        var newitem = $(this).clone();
        newitem.appendTo($('#canvas'));
        newitem.draggable();
        newitem.dblclick(dragOrResize);
        //$(this).clone().draggable().appendTo($('#canvas'));
    }

    function maxpriceChanged() {
        console.log('max price changed to ' + $('#maxprice').val());
        tools_filter = {price: {'$lt': parseInt($('#maxprice').val())}};
        console.log('filter changed to ' + tools_filter.price);
        tools = shopeiro.chain().find(tools_filter).limit(tools_max).data();
        updateToolsFilter();
    }
    //$('#filter-submit').click(alert('changed'));

    var modeDrag = true;
    var issuesSelector;

    function dragOrResize(e) {
        console.log("issue clicked");
        issuesSelector = $(e.target);
        //issuesSelector.hide();
        //        issuesSelector.draggable('destroy');
        //        issuesSelector.resizable();

        if (modeDrag) {
            console.log('resizableMode - turned on');
            modeDrag = false;
            issuesSelector.draggable('destroy');
            issuesSelector.resizable();
        }
        else {
            console.log('modeDrag - turned on');
            modeDrag = true;
            issuesSelector.resizable('destroy');
            issuesSelector.draggable();
        }
    }
    $('#top01').one("click", addIssue);
    //    $('#canvas').resizable();
    //    $('#top02').draggable();
    //http://stackoverflow.com/questions/13198131/how-to-save-a-html5-canvas-as-image-on-a-server
    $('#screen').click(function () {
        alert("screen");
        html2canvas(document.getElementById("canvas"), {
            onrendered: function (canvas) {
                document.body.appendChild(canvas);
                var dataURL = canvas.toDataURL();
                console.log(dataURL);
                $.post('upload', {img: dataURL});
                //save2server(canvas);
            }
        });
    });
</script>

</body>
</html>
{% endraw %}
<!--types:
['Мокасины', 'Слипоны', 'Кроссовки', 'Платье', 'Футболка', 'Ремень', 'Сапоги', 'Полусапоги', 'Шляпа', 'Босоножки', 'Туника пляжная', 'Сандалии', 'Блуза', 'Майка', 'Сумка', 'Кеды', 'Клатч', 'Пуловер', 'Джинсы', 'Костюм', 'Трусы', 'Юбка', 'Ботинки', 'Шорты джинсовые', 'Шапка', 'Рюкзак', 'Гетры', 'Кардиган', 'Лоферы', 'Джемпер', 'Куртка утепленная', 'Сабо', 'Очки солнцезащитные', 'Чехол для iPhone', 'Угги', 'Туника', 'Палантин', 'Комбинезон', 'Эспадрильи', 'Балетки', 'Ключница', 'Платок', 'Шлепанцы', 'Сумка спортивная', 'Свитшот', 'Топ', 'Бутсы зальные', 'Бейсболка', 'Резиновые сапоги', 'Рубашка', 'Визитница', 'Лонгслив', 'Свитер', 'Боди', 'Туфли', 'Кеды на танкетке', 'Ботильоны', 'Галстук', 'Сорочка ночная', 'Бюстгальтер', 'Брюки', 'Портмоне', 'Кошелек', 'Плащ', 'Часы', 'Поло', 'Купальник', 'Тапочки', 'Манишка', 'Жакет', 'Сланцы', 'Парка', 'Шарф', 'Лиф', 'Дубленка', 'Дутики', 'Шорты', 'Водолазка', 'Куртка', 'Комплект 6 шт.', 'Худи', 'Костюм спортивный', 'Куртка кожаная', 'Шорты для плавания', 'Шуба', 'Накидка', 'Пальто', 'Джеггинсы',  'Капри', 'Плавки', 'Брюки спортивные', 'Косметичка', 'Кепка', 'Юбка джинсовая', 'Зонт-трость', 'Портупея', 'Пиджак', 'Платье джинсовое', 'Сарафан', 'Панама', 'Леггинсы', 'Чехол для IPhone', 'Cлипоны', 'Термобелье', 'Болеро', 'Толстовка', 'Валенки', 'Шорты спортивные', 'Кредитница', 'Ветровка', 'Шиповки', 'Жилет', 'Футболка спортивная', 'Чиносы', 'Куртка джинсовая', 'Чехол для iPhone 5/5s', 'Майка домашняя', 'Пуховик', 'Сумка дорожная', 'Мешок', 'Жилет утепленный', 'Зонт складной', 'Топсайдеры', 'Бутсы', 'Майка спортивная', 'Чехол для планшета', 'Пояс', 'Топ спортивный', 'Рубашка джинсовая', 'Акваобувь', 'Наушники', 'Перчатки', 'Пижама', 'Топ бельевой', 'Ботфорты', 'Носки', 'Лонгслив спортивный', 'Комбинезон джинсовый', 'Пояс для чулок', 'Обложка для документов', 'Комплект 2 шт.', 'Жилет джинсовый', 'Брюки домашние', 'Колготки', 'Оправа', 'Пенал', 'Олимпийка',  'Бабочка', 'Белье корректирующее', 'Гольфы', 'Подтяжки', 'Луноходы', 'Платье пляжное', 'Воротник', 'Бриджи', 'Комплект термобелья', 'Сумка поясная', 'Полотенце', 'Сорочка','Халат домашний', 'Спортивный костюм', 'Подследники', 'Футболка домашняя', 'Юбка-шорты', 'Платок носовой', 'Портфель', 'Топ домашний', 'Полупальто', 'Ботинки трекинговые', 'Чехол для iPhone 6/6s', 'Унты', 'Комбинация', 'Резиновые полусапоги', 'Жилет кожаный', 'Угги на танкетке', 'Жилет меховой', 'Повязка', 'Спортивная сумка ', 'Комплект ремней', 'Берет', 'Чехол для телефона', 'Чемодан', 'Зажим для купюр', 'Пончо', 'Платье домашнее','Козырек', 'Шорты домашние', 'Лонгслив домашний', 'Парео', 'Сарафан джинсовый', 'Комплект пляжный', 'Несессер'
-->
    <!--function render_template(template, links) {-->
<!--//        console.log('processing ' + template);-->
<!--//        $("#canvas").empty();-->
<!--//        $('#canvas').append(templates[template].html);-->
<!--//        var i = 0;-->
<!--//        for (i; i < templates[template].items; i++) {-->
<!--//            console.log("#" + i);-->
<!--//            //$("#" + i).attr('src', links[i]);-->
<!--//            $("#" + i).droppable({drop: droppedIn});-->
<!--//        }-->
<!--//    }-->
<!--//    $.get("/templates", function (data) {-->
<!--//        console.log(data);-->
<!--//        templates = data;-->
<!--//        render_template($("#switcher :selected").val(), links);-->
<!--//    });-->
<!--//    $.ajax({-->
<!--//        url: 'https://api.mlab.com/api/1/databases/shopeiro/collections/tools?l=12&apiKey=gyxt40ZuBvX0-Zs_ASfIphz87os52wgf',-->
<!--//        success: function (data) {-->
<!--//            console.log(data);-->
<!--//            tools = data;-->
<!--//            for (let i = 0; i < tools.length; i++) {-->
<!--//                tools[i].pictures[0] = tools[i].pictures[0].substring(0, tools[i].pictures[0].length - 3) + 'png';-->
<!--//                //console.log(tools[i].pictures[0])-->
<!--//            }-->
<!--//            updateToolsFilter();-->
<!--//        }-->
<!--//    });-->
<!--$('#down01').one("click", addIssue);-->
<!--$('#shoes01').one("click", addIssue); -->
<!--$('#acc01').one("click", addIssue);-->

<!--<img id="down01" src="static/dresses/down01.jpg" style="left: 122px; top: 10px">-->
<!--<img id="shoes01" src="static/dresses/shoes01.jpg" style="left: 244px; top: 10px">-->

<!--&lt;!&ndash;<img id="top02" src="dresses/top02.jpg" style="left: 0; top: 140px">&ndash;&gt;-->
<!--&lt;!&ndash;<img id="stop01" src="dresses/stop01.jpg" style="left: 122px; top: 140px">&ndash;&gt;-->
<!--<img id="acc01" src="static/dresses/acc01.jpg" style="left: 244px; top: 140px">-->

<!--<ul class="nav nav-pills">-->
<!--<li role="presentation" id="active"><a href="#">Male</a></li>-->
<!--<li role="presentation"><a href="#">Female</a></li>-->
<!--<li role="presentation"><a href="#">Colors</a></li>-->
<!--<li role="presentation"><a href="#">Budget</a></li>-->
<!--</ul>-->
<!--<ul class="nav nav-tabs">-->
<!--<li role="presentation" class="active"><a href="#">1</a></li>-->
<!--<li role="presentation"><a href="#">2</a></li>-->
<!--<li role="presentation"><a href="#">3</a></li>-->
<!--<li role="presentation"><a href="#">4</a></li>-->
<!--<li role="presentation"><a href="#">5</a></li>-->
<!--</ul>-->